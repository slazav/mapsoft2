#!/bin/bash -efu


P=${1:-./ms2proj}

. ../../modules/test_lib.sh

help_msg="$($P -h ||:)"
assert_cmd "$P" "$help_msg" 1
assert_cmd "$P --help" "$help_msg" 1
assert_cmd "$P -f " "Error: missing argument: -f" 1
assert_cmd "$P --xxx " "Error: unknown option: --xxx" 1

assert_cmd "$P a " "Error: Can't parse form: a" 1

##################
## points

assert_cmd "$P [10,10,10]" "[10,10,10]" 0

assert_cmd "$P [10,10,10] [10,10,10]" "[10,10,10]
[10,10,10]" 0

assert_cmd "$P -z -t SU39 [39,55]" "[7500118.65,6097339.95,2.45208547]" 0

assert_cmd "$P -z -b -f SU39 [39,55]" "[7500118.65,6097339.95,2.45208547]" 0

assert_cmd "$P -t SU39 [39,55]" "[7500118.65,6097339.95]" 0

assert_cmd "$P -b -t SU39 [7500118.65,6097339.95]" "[39,55]" 0

# coordinates are taken from Retkikartta interface (<1m accuracy)
assert_cmd "$P -z -t FI [24.871483333,60.1879266666]" "[3382086.06,6677045.97,-24.6031926]" 0
assert_cmd "$P    -t FI [24.871483333,60.1879266666]" "[3382086.06,6677045.97]" 0
assert_cmd "$P    -t ETRS89 [24.871483333,60.1879266666]" "[381963.983,6674243.13]" 0
assert_cmd "$P -z -t ETRS89 [24.871483333,60.1879266666]" "[381963.983,6674243.13]" 0

##################
## lines

assert_cmd "$P [[39,55],[40,56]]" "[[39,55],[40,56]]" 0

assert_cmd "$P -b -f SU39 [[39,55],[40,57]]"\
  "[[7500118.65,6097339.95],[7515917.6,6153032.39],[7538861.72,6236684.32],[7560889.56,6320468.22]]" 0

assert_cmd "$P -a 10 -b -f SU39 [[39,55],[40,57]]"\
  "[[7500118.65,6097339.95],[7560889.56,6320468.22]]" 0

assert_cmd "$P -a 0 -b -f SU39 [[39,55],[40,57]]"\
  "[[7500118.65,6097339.95],[7560889.56,6320468.22]]" 0

#################
## shift/scale

assert_cmd "$P --scale 2 --shift [1,3] [[1,1],[2,2]]" "[[4,8],[6,10]]" 0
assert_cmd "$P --scale 2 --shift [1,3] [[],[[1,1],[2,2]]]" "[[],[[4,8],[6,10]]]" 0
assert_cmd "$P --scale 2 --shift [1,3] [1,1]" "[4,8]" 0
assert_cmd "$P -t FI -b -S 1000 -M [3000,6000] [382.08606,677.04597]" "[24.8714834,60.1879267]" 0

